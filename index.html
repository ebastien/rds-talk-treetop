<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
	"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <title>PEGs with Treetop</title>

  <meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"/>

  <link rel="stylesheet" href=".//css/reset.css" type="text/css"/>

  <link type="text/css" href=".//css/fg.menu.css" media="screen" rel="stylesheet" />
  <link type="text/css" href=".//css/theme/ui.all.css" media="screen" rel="stylesheet" />
  <link type="text/css" href=".//css/sh_style.css" rel="stylesheet" />
  <link type="text/css" href=".//css/tipsy.css" rel="stylesheet" />

  <link rel="stylesheet" href=".//css/showoff.css" type="text/css"/>

  <script type="text/javascript" src=".//js/jquery-1.4.2.min.js"></script>
  <script type="text/javascript" src=".//js/jquery.cycle.all.js"></script>
	<script type="text/javascript" src=".//js/jquery-print.js"></script>
  <script type="text/javascript" src=".//js/jquery.batchImageLoad.js"></script>
  <script type="text/javascript" src=".//js/jquery.parsequery.min.js"></script>
  <script type="text/javascript" src=".//js/jquery.doubletap-0.1.js"></script>
  <script type="text/javascript" src=".//js/jquery.tipsy.js"></script>

  <script type="text/javascript" src=".//js/fg.menu.js"></script>
  <script type="text/javascript" src=".//js/showoff.js"></script>
  <script type="text/javascript" src=".//js/jTypeWriter.js"> </script>
  <script type="text/javascript" src=".//js/sh_main.min.js"></script>
  <script type="text/javascript" src=".//js/core.js"></script>
  <script type="text/javascript" src=".//js/showoffcore.js"></script>
  <script type="text/javascript" src=".//js/coffee-script.js"></script>

  
    
      <script type="text/javascript" src=".//js/sh_lang/sh_ruby.min.js"></script>
    
  

  
    
    <link rel="stylesheet" href=".//file/default.css" type="text/css"/>
  

  

  <script type="text/javascript">
  $(function(){
      setupPreso(false, './');
  });
  </script>

</head>

<body>

<a tabindex="0" href="#search-engines" class="fg-button fg-button-icon-right ui-widget ui-state-default ui-corner-all" id="navmenu"><span class="ui-icon ui-icon-triangle-1-s"></span>slides</a>
<div id="navigation" class="hidden"></div>
<a tabindex="1" href="#search-engines" class="fg-button fg-button-icon-right ui-widget ui-state-default ui-corner-all" id="stylemenu"><span class="ui-icon ui-icon-triangle-1-s"></span>styles</a>
<div id="stylepicker" class="hidden"></div>


<div id="help">
  <table>
    <tr><td class="key">z, ?</td><td>toggle help (this)</td></tr>
    <tr><td class="key">space, &rarr;</td><td>next slide</td></tr>
    <tr><td class="key">shift-space, &larr;</td><td>previous slide</td></tr>
    <tr><td class="key">d</td><td>toggle debug mode</td></tr>
    <tr><td class="key">## &lt;ret&gt;</td><td>go to slide #</td></tr>
    <tr><td class="key">c, t</td><td>table of contents (vi)</td></tr>
    <tr><td class="key">f</td><td>toggle footer</td></tr>
    <tr><td class="key">g</td><td>toggle follow</td></tr>
    <tr><td class="key">r</td><td>reload slides</td></tr>
    <tr><td class="key">n</td><td>toggle notes</td></tr>
    <tr><td class="key">p</td><td>run preshow</td></tr>
    <tr><td class="key">P</td><td>toggle pause</td></tr>
    <tr><td class="key">s</td><td>choose style</td></tr>
  </table>
</div>

<div class="buttonNav">
  <input type="submit" onClick="prevStep();" value="prev"/>
  <input type="submit" onClick="nextStep();" value="next"/>
</div>

<div id="preso"><center>loading presentation...</center></div>
<div id="footer">
  <span id="followMode"></span>
  <span id="slideInfo"></span>
  <span id="debugInfo"></span>
  <span id="notesInfo"></span>
  <span id="slideFilename"></span>
  <img id="disconnected" src="/css/disconnected.png" />
</div>

<div id="slides" class="offscreen" style="display:none;">
<div id="one/01_slide" class="slide title" data-transition="none"><div class="content title" ref="one/01_slide/1">
<h1>Parsing Expression Grammars with Treetop</h1>

<div class="title_desc">
  <ul>
<li><a href="http://twitter.com/ebastien">Emmanuel Bastien</a></li>
    <li><a href="http://rivierarb.fr">Riviera.rb</a></li>
    <li>February 4, 2014</li>
  </ul>
</div></div>
</div><div id="one/01_slide" class="slide " data-transition="none"><div class="content " ref="one/01_slide/2">
<h2>Why do we care ?</h2>

<ul>
<li>Most of your programs take some kind of input.</li>
<li>Let's assume you don't blindly start processing any input.</li>
<li>How do you make sure the input is valid?</li>
</ul></div>
</div><div id="one/01_slide" class="slide " data-transition="none"><div class="content " ref="one/01_slide/3">
<h2>The fact is:</h2>

<pre><code>You must validate with a computational mechanism
at least as strong as the language being validated

-- Meredith L. Patterson
</code></pre>

<ul>
<li>So you build a parser,</li>
<li>And now you are safe ...</li>
</ul></div>
</div><div id="one/01_slide" class="slide " data-transition="none"><div class="content " ref="one/01_slide/4">
<h2>... or not !?</h2>

<ul>
<li>How long does your parser take to accept or reject your input?</li>
</ul></div>
</div><div id="one/01_slide" class="slide " data-transition="none"><div class="content " ref="one/01_slide/5">
<h2>Chomsky hierarchy</h2>

<ul>
<li>Type-0: All formal grammars</li>
<li>Type-1: Context-sensitive grammars</li>
<li>Type-2: Context-free grammars</li>
<li>Type-3: Regular grammars</li>
</ul></div>
</div><div id="one/01_slide" class="slide " data-transition="none"><div class="content " ref="one/01_slide/6">
<h2>Parsing automata</h2>

<ul>
<li>Type-0/1: Turing machine</li>
<li>Type-2: Pushdown automaton</li>
<li>Type-3: Finite state automaton</li>
</ul></div>
</div><div id="one/01_slide" class="slide " data-transition="none"><div class="content " ref="one/01_slide/7">
<ul>
<li>How long might a Turing machine take to accept or reject your input?</li>
</ul></div>
</div><div id="one/01_slide" class="slide " data-transition="none"><div class="content " ref="one/01_slide/8">
<h2>Safe places to be:</h2>

<ul>
<li>At most deterministic context-free</li>
<li>Or even better, regular</li>
</ul></div>
</div><div id="one/01_slide" class="slide " data-transition="none"><div class="content " ref="one/01_slide/9">
<h2>Use case: a full text query language</h2>

<p>Subset of Lucene query syntax:</p>

<pre><code>&lt;query&gt; ::= [ &lt;field&gt; ':' ] &lt;term&gt;
&lt;term&gt;  ::= &lt;word&gt; | '"' &lt;phrase&gt; '"'

Examples:

title:"regular grammar"
keyword:parser
rivierarb
"finite \"state\" automaton"
</code></pre></div>
</div><div id="one/01_slide" class="slide " data-transition="none"><div class="content " ref="one/01_slide/10">
<h2>Regular languages</h2>

<ul>
<li>Let's use Ruby built-in regular expressions!</li>
</ul></div>
</div><div id="one/01_slide" class="slide " data-transition="none"><div class="content " ref="one/01_slide/11">
<h2>Regular languages</h2>

<pre class="sh_ruby"><code># &lt;query&gt; ::= [ &lt;field&gt; ':' ] &lt;term&gt;
# &lt;term&gt;  ::= &lt;word&gt; | '"' &lt;phrase&gt; '"'

query = /(\w+:)?(\w+|\"([^\"]|\[\"])*\")/</code></pre></div>
</div><div id="one/01_slide" class="slide " data-transition="none"><div class="content " ref="one/01_slide/12">
<h2>Ruby <em>regular</em> expressions?</h2>

<pre class="sh_ruby"><code>"aaaaaaaaaaaaaaaaaaaaaaaaaaaaab" =~ /^(a+)+$/</code></pre></div>
</div><div id="one/01_slide" class="slide center" data-transition="none"><div class="content center" ref="one/01_slide/13">
<p><img src="./file/one/grep1p.png"/></p></div>
</div><div id="one/01_slide" class="slide " data-transition="none"><div class="content " ref="one/01_slide/14">
<pre><code>Today, regular expressions have also become a shining example of
how ignoring good theory leads to bad programs.

-- Russ Cox
</code></pre></div>
</div><div id="one/01_slide" class="slide " data-transition="none"><div class="content " ref="one/01_slide/15">
<h2>Regular expressions</h2>

<ul>
<li>Extensions like <em>backreferences</em> built into common standard regular expression
implementations lead to non-context-free grammars.</li>
<li>In this case there is no better algorithm than exponential!</li>
<li>So be careful when writting regular expressions,</li>
<li>and <strong>NEVER</strong> take regular expressions from untrusted input!</li>
</ul></div>
</div><div id="one/01_slide" class="slide " data-transition="none"><div class="content " ref="one/01_slide/16">
<h2>Use case: a more powerful query language</h2>

<pre><code>title:"regular grammar" AND
( keyword:parser OR rivierarb ) AND
"finite \"state\" automaton"
</code></pre></div>
</div><div id="one/01_slide" class="slide " data-transition="none"><div class="content " ref="one/01_slide/17">
<h2>Efficient deterministic context-free parsers</h2>

<ul>
<li>LR(k) -- rightmost derivation with <em>k</em> lookahead</li>
<li>LL(k) -- leftmost derivarion with <em>k</em> lookahead</li>
<li>Packrat/PEG</li>
<li>Reminder: ad-hoc recursive-descent with naive backtracking
is exponential-time!</li>
</ul></div>
</div><div id="one/01_slide" class="slide " data-transition="none"><div class="content " ref="one/01_slide/18">
<h2>Some concrete parsers</h2>

<ul>
<li>GNU Bison (LALR)</li>
<li>ANTLR (LL &amp; more)</li>
<li>Treetop (PEG)</li>
</ul></div>
</div><div id="one/01_slide" class="slide " data-transition="none"><div class="content " ref="one/01_slide/19">
<h2>PEG selling points</h2>

<ul>
<li>Recognition-based (vs. generation-based)</li>
<li>Prioritized choices</li>
<li>Greedy rules</li>
<li>Syntactic predicates</li>
<li>No separate lexer (expression of mixed languages!)</li>
</ul></div>
</div><div id="one/01_slide" class="slide " data-transition="none"><div class="content " ref="one/01_slide/20">
<h2>Structure of PEGs</h2>

<ul>
<li>finite&#xA0;set&#xA0;of&#xA0;terminals</li>
<li>finite&#xA0;set&#xA0;of&#xA0;nonterminals N</li>
<li>finite&#xA0;set&#xA0;of&#xA0;rules&#xA0;of&#xA0;the form&#xA0;A&#xA0;&lt;- e where&#xA0;A&#xA0;&#x2208;&#xA0;N,&#xA0;e&#xA0;is&#xA0;a&#xA0;parsing&#xA0;expression</li>
<li>a&#xA0;parsing&#xA0;expression&#xA0;called&#xA0;the&#xA0;start&#xA0;expression</li>
</ul></div>
</div><div id="one/01_slide" class="slide " data-transition="none"><div class="content " ref="one/01_slide/21">
<h2>Parsing expressions</h2>

<ul>
<li>empty string</li>
<li>terminal</li>
<li>nonterminal</li>
<li>sequence of parsing expressions</li>
<li>prioritized choice between alternatives</li>
<li>optional, zero-or-more, one-or-more (all greedy)</li>
<li>syntactic predicates (does not consume input)</li>
</ul></div>
</div><div id="one/01_slide" class="slide " data-transition="none"><div class="content " ref="one/01_slide/22">
<pre class="sh_ruby"><code>grammar Arithmetic
  rule additive
    multitive ( '+' multitive )*
  end
  rule multitive
    primary ( '*' primary )*
  end
  rule primary
    '(' additive ')' / number
  end
  rule number
    '-'? [0-9]+
  end
end</code></pre></div>
</div><div id="one/01_slide" class="slide " data-transition="none"><div class="content " ref="one/01_slide/23">
<h2>Demo</h2></div>
</div><div id="one/01_slide" class="slide " data-transition="none"><div class="content " ref="one/01_slide/24">
<h2>Limitations</h2>

<ul>
<li>Packrat parsers are not minimal in space compared to LL/LR parsers.</li>
<li>Not good <em>as is</em> for <em>stateful</em> syntax (e.g. C and C++).</li>
<li>Equality of languages generated by CFGs is undecidable.</li>
<li>No proof that PEGs can generate all context-free languages.</li>
<li>Left recursion is not available with PEGs.</li>
<li>No built-in operator precedence support.</li>
</ul></div>
</div><div id="one/01_slide" class="slide " data-transition="none"><div class="content " ref="one/01_slide/25">
<h2>References</h2>

<ul>
<li><a href="http://www.youtube.com/watch?v=3kEfedtQVOY">The Science of Insecurity</a></li>
<li><a href="http://swtch.com/%7Ersc/regexp/regexp1.html">Regular Expression Matching Can Be Simple And Fast</a></li>
<li><a href="http://pdos.csail.mit.edu/papers/parsing%3Apopl04.pdf">Parsing&#xA0;Expression&#xA0;Grammars paper</a></li>
<li><a href="http://www.brynosaurus.com/pub/lang/peg-slides.pdf">Parsing&#xA0;Expression&#xA0;Grammars slides</a></li>
<li><a href="http://bford.info/packrat/">Packrat Parsing and PEGs Page</a></li>
<li><a href="http://treetop.rubyforge.org/">Treetop</a></li>
<li><a href="http://en.wikipedia.org/wiki/Shunting_yard_algorithm">Shunting-yard algorithm</a></li>
</ul></div>
</div></div>
<div id="pauseScreen">
  PAUSED
</div>

</body>
</html>
